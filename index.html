<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0e17">
<title>Hedonicum</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç∑</text></svg>">
<style>
:root{--bg:#0a0e17;--bg-card:#111827;--bg-el:#151d2e;--gold:#d4a96a;--gold-dim:rgba(212,169,106,.12);--gold-glow:rgba(212,169,106,.06);--gold-border:rgba(212,169,106,.2);--text:#e2e8f0;--text-m:#94a3b8;--text-d:#6b7a8d;--text-l:#3b4254;--border:#1e2538;--border-d:#1a1f2e;--green:#48bb78;--green-d:rgba(72,187,120,.15);--red:#e53e3e;--red-d:rgba(229,62,62,.1);--font:-apple-system,'system-ui','Segoe UI',Roboto,sans-serif}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{background:var(--bg);color:var(--text);font-family:var(--font);font-size:15px;overflow-x:hidden;-webkit-font-smoothing:antialiased}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
@keyframes countUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}
@keyframes pulseGlow{0%,100%{box-shadow:0 0 20px rgba(212,169,106,.05)}50%{box-shadow:0 0 40px rgba(212,169,106,.12)}}
@keyframes slideIn{from{opacity:0;transform:translateX(-12px)}to{opacity:1;transform:translateX(0)}}
@keyframes pulse{0%,100%{opacity:.4}50%{opacity:1}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.app{max-width:480px;margin:0 auto;min-height:100vh;min-height:100dvh;position:relative;padding-bottom:80px}
.toast{position:fixed;top:env(safe-area-inset-top,12px);left:50%;transform:translateX(-50%);background:var(--bg-card);border:1px solid var(--border);color:var(--text-d);padding:10px 24px;border-radius:12px;font-size:13px;z-index:99;animation:fadeIn .2s;backdrop-filter:blur(8px)}
.nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:480px;background:rgba(10,14,23,.92);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border-top:1px solid var(--border-d);z-index:50;display:flex;padding:6px 0;padding-bottom:max(6px,env(safe-area-inset-bottom))}
.ni{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;padding:6px 0;color:var(--text-d);font-size:10px;letter-spacing:.5px;cursor:pointer;background:none;border:none;font-family:var(--font);transition:color .2s}
.ni.on{color:var(--gold)}.ni-ic{font-size:20px;line-height:1}
.tab{display:none}.tab.on{display:block}
.hero{padding:32px 20px 20px;text-align:center;position:relative}
.hero::before{content:'';position:absolute;top:0;left:0;right:0;height:200px;background:radial-gradient(ellipse at center top,rgba(212,169,106,.06) 0%,transparent 70%);pointer-events:none}
.hero h1{font-size:36px;font-weight:800;color:var(--gold);letter-spacing:.5px;position:relative}
.hero .sub{color:var(--text-l);font-size:11px;letter-spacing:2.5px;text-transform:uppercase;margin-top:4px}
.identity{margin:20px 20px 0;background:var(--bg-card);border:1px solid var(--border);border-radius:16px;padding:18px;position:relative;overflow:hidden}
.identity::after{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--gold),rgba(212,169,106,.3),var(--gold));background-size:200% 100%;animation:shimmer 3s ease-in-out infinite}
.id-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.id-h{font-size:20px;font-weight:800}
.id-badge{font-size:10px;font-weight:700;color:var(--gold);border:1px solid var(--gold-border);padding:4px 12px;border-radius:20px;letter-spacing:.8px;text-transform:uppercase}
.id-bio{color:var(--text-m);font-size:13px;line-height:1.6}
.id-bio b{color:var(--text);font-weight:700}
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin:16px 20px 0}
.st{background:var(--bg-card);border:1px solid var(--border-d);border-radius:12px;padding:14px 6px;text-align:center;animation:countUp .5s ease-out both}
.st:nth-child(1){animation-delay:.1s}.st:nth-child(2){animation-delay:.15s}.st:nth-child(3){animation-delay:.2s}.st:nth-child(4){animation-delay:.25s}
.st-n{font-size:26px;font-weight:800;line-height:1;margin-bottom:3px}.st-n.g{color:var(--gold)}
.st-l{font-size:8px;color:var(--text-d);letter-spacing:1px;text-transform:uppercase;font-weight:600}
.sec{margin:24px 20px 0}.sec-h{font-size:11px;color:var(--text-l);letter-spacing:2px;text-transform:uppercase;font-weight:600;margin-bottom:12px}
.dna{display:flex;flex-wrap:wrap;gap:7px}
.dp{background:var(--gold-dim);border:1px solid var(--gold-border);border-radius:20px;padding:7px 14px;font-size:12px;color:var(--gold);font-weight:500;animation:slideIn .4s ease-out both}
.dp:nth-child(1){animation-delay:.1s}.dp:nth-child(2){animation-delay:.15s}.dp:nth-child(3){animation-delay:.2s}.dp:nth-child(4){animation-delay:.25s}.dp:nth-child(5){animation-delay:.3s}.dp:nth-child(6){animation-delay:.35s}
.cg{display:grid;grid-template-columns:repeat(2,1fr);gap:7px}
.cr{display:flex;align-items:center;justify-content:space-between;background:var(--bg-card);border:1px solid var(--border-d);border-radius:11px;padding:12px 14px;animation:fadeUp .4s ease-out both}
.cr:nth-child(1){animation-delay:.05s}.cr:nth-child(2){animation-delay:.1s}.cr:nth-child(3){animation-delay:.15s}.cr:nth-child(4){animation-delay:.2s}.cr:nth-child(5){animation-delay:.25s}.cr:nth-child(6){animation-delay:.3s}
.cf{font-size:16px;margin-right:7px}.cn{font-size:13px;font-weight:600;flex:1}.cc{font-size:14px;font-weight:800;color:var(--gold)}
.vr{display:flex;align-items:center;gap:10px;padding:12px 0;border-bottom:1px solid var(--border-d);animation:fadeUp .3s ease-out both}.vr:last-child{border-bottom:none}
.vr-r{font-size:11px;font-weight:800;color:var(--text-l);min-width:18px}.vr-i{flex:1}.vr-n{font-size:14px;font-weight:700}.vr-m{font-size:11px;color:var(--text-d);margin-top:2px}
.vr-v{font-size:18px;font-weight:800;color:var(--gold)}.vr-vl{font-size:8px;color:var(--text-d);text-transform:uppercase;letter-spacing:.8px}
.disc{padding:32px 20px 20px}.disc-h{text-align:center;margin-bottom:20px}.disc-h h2{font-size:28px;font-weight:800;margin-bottom:4px}.disc-h p{color:var(--text-d);font-size:13px}
.pow{display:flex;align-items:center;gap:10px;background:var(--bg-card);border:1px solid var(--border-d);border-radius:12px;padding:10px 14px;margin-bottom:16px}
.pow-av{width:26px;height:26px;background:var(--gold-dim);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px}
.pow-t{font-size:11px;color:var(--text-d)}.pow-t b{color:var(--gold);font-weight:600}
.im{width:100%;background:var(--bg-card);border:1px solid var(--border);border-radius:14px;color:var(--text);font-family:var(--font);font-size:17px;padding:16px 20px;outline:none;margin-bottom:10px}
.im::placeholder{color:var(--text-d)}.im:focus{border-color:var(--gold-border)}
.is{width:100%;background:var(--bg-card);border:1px solid var(--border-d);border-radius:12px;color:var(--text-m);font-family:var(--font);font-size:13px;padding:12px 16px;outline:none;margin-bottom:12px}
.is::placeholder{color:var(--text-d)}
.fr{display:flex;gap:6px;margin-bottom:10px}
.fb{flex:1;background:transparent;border:1px solid var(--border-d);border-radius:10px;color:var(--text-d);font-family:var(--font);font-size:13px;padding:10px;text-align:center;cursor:pointer;font-weight:500;transition:all .2s}
.fb.on{background:var(--gold-dim);border-color:var(--gold-border);color:var(--gold)}.fb:active{transform:scale(.96)}
.go{width:100%;background:var(--gold);color:var(--bg);border:none;border-radius:12px;padding:14px;font-family:var(--font);font-size:15px;font-weight:700;cursor:pointer;margin-bottom:14px}
.go:active{transform:scale(.97);opacity:.9}.go:disabled{opacity:.5;cursor:wait}
.tbar{display:flex;justify-content:space-between;align-items:center;padding:6px 0;margin-bottom:10px}
.tbar-s{font-size:11px;color:var(--text-d)}.tbar-s .lv{color:var(--green)}.tbar-s .rj{color:var(--red)}
.tbar-r{background:transparent;border:none;color:var(--text-d);font-size:10px;cursor:pointer;font-family:var(--font);padding:4px 8px;border-radius:6px}
.ld{text-align:center;padding:48px 0;animation:pulse 2s ease-in-out infinite}.ld-t{font-size:15px;font-weight:600;color:var(--text-d)}.ld-s{color:var(--text-l);font-size:12px;margin-top:6px}
.err{color:var(--red);text-align:center;padding:20px;font-size:14px}
.cv{background:var(--bg-card);border-radius:16px;padding:18px;margin-bottom:14px;border-left:3px solid var(--gold-border)}.cv p{color:var(--text-m);font-size:13px;line-height:1.7}
.rc{background:var(--bg-card);border:1px solid var(--border-d);border-radius:14px;padding:16px;margin-bottom:8px;transition:all .3s;position:relative}
.rc.lc{border-color:rgba(72,187,120,.3)}.rc.xc{opacity:.12;max-height:0;padding:0!important;margin:0!important;overflow:hidden;border:none}
.rc-top{display:flex;justify-content:space-between;align-items:flex-start}.rc-i{flex:1;min-width:0}
.rc-nr{display:flex;align-items:center;gap:7px;flex-wrap:wrap}
.rc-nm{font-size:15px;font-weight:700;color:var(--text);text-decoration:none;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:200px;display:block}
.rc-nm:active{color:var(--gold)}.rc-cu{font-size:11px;color:var(--text-d);font-weight:500}.rc-pr{font-size:11px;color:var(--green);font-weight:600}
.rc-loc{color:var(--text-l);font-size:11px;margin-top:3px}
.rc-act{display:flex;align-items:center;gap:5px;flex-shrink:0}
.ab{background:transparent;border:1px solid var(--border-d);border-radius:10px;width:34px;height:34px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;transition:all .15s;color:var(--text-d)}
.ab:active{transform:scale(.9)}.ab.lo{background:var(--green-d);border-color:rgba(72,187,120,.3);color:var(--green)}.ab.xo{background:var(--red-d);border-color:rgba(229,62,62,.2);color:var(--red)}
.rc-sc{text-align:center;min-width:34px}.sn{font-size:26px;font-weight:800;line-height:1}
.s9{color:var(--gold)}.s7{color:#b8956a}.s5{color:var(--text-d)}.sl{color:var(--text-l)}
.rc-sp{color:var(--text-m);font-size:12px;line-height:1.5;margin-top:8px}
.rc-mp{color:var(--gold);font-size:11px;text-decoration:none;display:inline-block;margin-top:8px;opacity:.6;font-weight:500}
.rf{text-align:center;margin:32px 0 16px;color:var(--text-l);font-size:10px;letter-spacing:1px}
.es{text-align:center;padding:16px 0}.es p{color:var(--text-d);font-size:15px;line-height:1.6;font-weight:300}
.cp{display:flex;gap:7px;justify-content:center;flex-wrap:wrap;margin-top:18px}
.cpl{background:transparent;border:1px solid var(--border);border-radius:20px;color:var(--text-d);font-family:var(--font);font-size:13px;padding:8px 16px;cursor:pointer;font-weight:500}
.cpl:active{border-color:var(--gold-border);color:var(--gold);transform:scale(.96)}
.scan{padding:32px 20px 20px}.scan h2{font-size:28px;font-weight:800;text-align:center;margin-bottom:4px}
.scan .sh-p{color:var(--text-d);font-size:13px;text-align:center;margin-bottom:24px}
.scan-cta{background:var(--gold);border-radius:16px;padding:36px 20px;text-align:center;cursor:pointer;margin-bottom:14px;animation:pulseGlow 3s ease-in-out infinite;border:none;width:100%;font-family:var(--font)}
.scan-cta .si{font-size:44px;margin-bottom:10px}.scan-cta h3{font-size:18px;font-weight:700;color:var(--bg)}
.scan-cta p{font-size:12px;color:rgba(10,14,23,.6);margin-top:4px}
.scan-alt{background:var(--bg-card);border:1px solid var(--border);border-radius:14px;padding:18px;display:flex;align-items:center;gap:14px;cursor:pointer}
.scan-alt .sa-i{font-size:26px}.scan-alt h3{font-size:15px;font-weight:700}.scan-alt p{font-size:11px;color:var(--text-d);margin-top:2px}
.cel{padding:32px 20px 20px}.cel h2{font-size:28px;font-weight:800;margin-bottom:2px}.cel .ch-p{color:var(--text-d);font-size:13px;margin-bottom:16px}
.cel-f{display:flex;gap:6px;margin-bottom:14px}
.cft{background:transparent;border:1px solid var(--border-d);border-radius:10px;color:var(--text-d);font-family:var(--font);font-size:12px;padding:8px 14px;cursor:pointer;font-weight:500}
.cft.on{background:var(--gold-dim);border-color:var(--gold-border);color:var(--gold)}
.wr{display:flex;align-items:center;padding:13px 0;border-bottom:1px solid var(--border-d);animation:fadeUp .3s ease-out both}.wr:last-child{border-bottom:none}
.wr-i{flex:1}.wr-n{font-size:14px;font-weight:700}.wr-m{font-size:11px;color:var(--text-d);margin-top:2px}
.ws{font-size:24px;font-weight:800}.ws.w5{color:var(--gold)}.ws.w4{color:#b8956a}
.wt{font-size:8px;color:var(--gold);letter-spacing:.5px;font-weight:700}
.pb20{padding-bottom:20px}
</style>
</head>
<body>
<div class="app" id="app"></div>
<script>
const API="https://wine-profile.vercel.app/api/analyze";
const TASTE=`DINER PATTERN (what unites their 790 favorite venues across 31 countries):
1. SOUL over concept ‚Äî chef passion > design. Rintaro, Isolina, Taberna Antonio Sanchez
2. INGREDIENT-DRIVEN ‚Äî product is star. Bar Crudo, PPQ Dungeness, Parador La Huella
3. NEIGHBORHOOD-ROOTED ‚Äî locals eat here. Burma Superstar, Halu, La Carmencita
4. WINE AS COMPANION ‚Äî always part of the meal. Corks wine bar (38x), wineries (72 visits)
5. UNPRETENTIOUS QUALITY ‚Äî no dress code, serious food. El Che, Underdogs Tres
6. CULTURAL AUTHENTICITY ‚Äî teaches you about its cuisine. Rintaro, Isolina
7. FIRE AND SEA ‚Äî grilled, raw seafood, wood-fired
8. REGULARS' PLACE ‚Äî owner knows you after 3 visits
AVOIDS: tourist traps, chains, hotel restaurants, molecular gimmicks, Instagram-famous
NIGHTLIFE: neighborhood pubs (206x), craft cocktails (74x), dive bars (34x), natural wine bars (72x)
LOYALTY REFS: Burma Superstar (Burmese SF 39x), Corks (wine bar Medellin 38x), Rintaro (izakaya SF), Bar Crudo (raw bar SF), Parador La Huella (beach Uruguay), La Carmencita (vermouth Madrid)`;

let S={tab:'profile',city:'',loc:'',vibe:'all',loading:false,phase:'',results:null,error:'',loved:{},rejected:{},toast:''};
try{S.loved=JSON.parse(localStorage.getItem('h-loved')||'{}')}catch{}
try{S.rejected=JSON.parse(localStorage.getItem('h-rej')||'{}')}catch{}
function sL(){localStorage.setItem('h-loved',JSON.stringify(S.loved))}
function sR(){localStorage.setItem('h-rej',JSON.stringify(S.rejected))}
function toast(m){S.toast=m;render();setTimeout(()=>{S.toast='';render()},2000)}
function tLove(n){if(S.loved[n]){delete S.loved[n];toast('Removed')}else{S.loved[n]=true;toast('‚ô• Saved')}if(S.loved[n]&&S.rejected[n]){delete S.rejected[n];sR()}sL();render()}
function tRej(n){if(S.rejected[n]){delete S.rejected[n];toast('Restored')}else{S.rejected[n]=true;toast('‚úï Dismissed')}if(S.rejected[n]&&S.loved[n]){delete S.loved[n];sL()}sR();render()}
function clr(){S.loved={};S.rejected={};localStorage.removeItem('h-loved');localStorage.removeItem('h-rej');toast('Reset');render()}
function fb(){const l=Object.keys(S.loved),r=Object.keys(S.rejected);let c='';if(l.length)c+=`\n\nUSER-CONFIRMED LOVES:\n${l.map(n=>'  ‚ô• '+n).join('\n')}`;if(r.length)c+=`\n\nUSER-REJECTED (AVOID):\n${r.map(n=>'  ‚úï '+n).join('\n')}`;return c}
async function callAPI(sys,usr,mdl,srch){const b={system:sys,messages:[{role:'user',content:usr}],max_tokens:3000};if(mdl)b.model=mdl;if(srch)b.tools=[{type:'web_search_20250305',name:'web_search'}];const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(b)});return await r.json()}
function txt(d){return(d.content||[]).filter(b=>b.type==='text').map(b=>b.text).join('\n')}
function pj(t){const c=t.replace(/```json|```/g,'').trim();const s=c.indexOf('{'),e=c.lastIndexOf('}');return s>=0?JSON.parse(c.substring(s,e+1)):null}
const VM={all:'restaurants, bars, and wine spots',restaurant:'restaurants and cafes only',bar:'bars, pubs, cocktail bars, dive bars',wine:'wine bars, natural wine spots, enotecas, vinotecas'};
async function go(){if(!S.city.trim()||S.loading)return;S.loading=true;S.error='';S.results=null;render();const loc=S.loc.trim()?`near ${S.loc.trim()} (within 30 min walking distance)`:'';try{S.phase='Searching for real places...';render();const sr=await callAPI('You are a restaurant researcher. Search the web and return only REAL, currently operating places. Never invent names.',`Search for the best ${VM[S.vibe]} in ${S.city}${loc?' '+loc:''}. Quality-focused, local favorites, hidden gems. Search 3-4 different queries. List 12-18 real places: name, neighborhood, cuisine, price range.`,'claude-sonnet-4-20250514',true);const found=txt(sr);if(!found||found.length<20){S.error="Couldn't find places.";S.loading=false;render();return}S.phase='Matching to your palate...';render();const wc=S.loc.trim()?`Diner is near: ${S.loc.trim()}. Include walking time.`:'Include neighborhood.';const sc=await callAPI(`You score places against a diner's taste pattern.\n\n${TASTE}${fb()}\n\nRespond ONLY with valid JSON:\n{"city_vibe":"2-3 sentences","restaurants":[{"name":"exact name","neighborhood":"area","cuisine":"type","price":"$$","walk":"time or area","spirit":"which loyalty venue this echoes, 1 sentence","score":8,"q":"name city for maps"}]}\nSort by score desc.`,`City: ${S.city}\n${wc}\nCategory: ${VM[S.vibe]}\n\nPlaces found:\n${found}\n\nScore each. Only include places from the search results.`,'claude-sonnet-4-20250514',false);const p=pj(txt(sc));if(p?.restaurants?.length)S.results=p;else S.error="Couldn't score. Try again."}catch(e){S.error='Error: '+e.message}S.loading=false;S.phase='';render()}
function sc(s){return s>=9?'s9':s>=7?'s7':s>=5?'s5':'sl'}
function maps(r){return`https://www.google.com/maps/search/${encodeURIComponent(r.q||r.name+' '+S.city)}`}
function esc(n){return n.replace(/'/g,"\\'").replace(/"/g,'&quot;')}
function switchTab(t){S.tab=t;window.scrollTo(0,0);render()}

function render(){
const lc=Object.keys(S.loved).length,rc=Object.keys(S.rejected).length;let h='';
if(S.toast)h+=`<div class="toast">${S.toast}</div>`;
const tabs=[{id:'profile',ic:'üë§',l:'Profile'},{id:'discover',ic:'üîç',l:'Discover'},{id:'scan',ic:'üì∑',l:'Scan'},{id:'cellar',ic:'üç∑',l:'Cellar'}];
h+=`<nav class="nav">`;tabs.forEach(t=>{h+=`<button class="ni${S.tab===t.id?' on':''}" onclick="switchTab('${t.id}')"><span class="ni-ic">${t.ic}</span>${t.l}</button>`});h+=`</nav>`;

if(S.tab==='profile'){
h+=`<div class="hero"><h1>Hedonicum</h1><div class="sub">Taste Intelligence</div></div>`;
h+=`<div class="identity"><div class="id-top"><div class="id-h">@Holdmybirra</div><div class="id-badge">Sommelier</div></div><div class="id-bio"><b>231 wines</b> across <b>12 countries</b>. <b>790 venues</b> across <b>31 countries</b>. Tempranillo loyalist. Neighborhood over hype. Fire &amp; sea over foam &amp; tweezers.</div></div>`;
h+=`<div class="stats">`;[{n:'231',l:'Wines',g:1},{n:'790',l:'Venues'},{n:'31',l:'Countries',g:1},{n:'4.2',l:'Avg Score'}].forEach(s=>{h+=`<div class="st"><div class="st-n${s.g?' g':''}">${s.n}</div><div class="st-l">${s.l}</div></div>`});h+=`</div>`;
h+=`<div class="sec"><div class="sec-h">Taste DNA</div><div class="dna">`;['üî• Soul over concept','üêü Fire & sea','üèòÔ∏è Neighborhood roots','üç∑ Wine companion','üßë‚Äçüç≥ Ingredient-driven','ü™ë Regulars\' place'].forEach(d=>{h+=`<div class="dp">${d}</div>`});h+=`</div></div>`;
h+=`<div class="sec"><div class="sec-h">Passport</div><div class="cg">`;[{f:'üá∫üá∏',n:'USA',c:412},{f:'üá®üá¥',n:'Colombia',c:198},{f:'üá™üá∏',n:'Spain',c:77},{f:'üáÆüáπ',n:'Italy',c:65},{f:'üá∫üáæ',n:'Uruguay',c:17},{f:'üá´üá∑',n:'France',c:12}].forEach(x=>{h+=`<div class="cr"><span class="cf">${x.f}</span><span class="cn">${x.n}</span><span class="cc">${x.c}</span></div>`});h+=`</div></div>`;
h+=`<div class="sec pb20"><div class="sec-h">Loyalty Venues</div>`;[{r:1,n:'Burma Superstar',m:'Burmese ¬∑ San Francisco',v:39},{r:2,n:'Corks Wine Bar',m:'Wine Bar ¬∑ Medell√≠n',v:38},{r:3,n:'Rintaro',m:'Izakaya ¬∑ San Francisco',v:24},{r:4,n:'Bar Crudo',m:'Raw Bar ¬∑ San Francisco',v:21},{r:5,n:'Parador La Huella',m:'Beach ¬∑ Jos√© Ignacio',v:18}].forEach((x,i)=>{h+=`<div class="vr" style="animation-delay:${i*.05}s"><div class="vr-r">${x.r}</div><div class="vr-i"><div class="vr-n">${x.n}</div><div class="vr-m">${x.m}</div></div><div style="text-align:right"><div class="vr-v">${x.v}</div><div class="vr-vl">visits</div></div></div>`});h+=`</div>`;
}

if(S.tab==='discover'){
h+=`<div class="disc"><div class="disc-h"><h2>Discover</h2><p>Your palate, any city</p></div>`;
h+=`<div class="pow"><div class="pow-av">üç∑</div><div class="pow-t">Powered by <b>@Holdmybirra's palate</b> ‚Äî 790 venues, 31 countries</div></div>`;
h+=`<input class="im" id="ci" value="${S.city}" placeholder="Where are you going?"><input class="is" id="li" value="${S.loc}" placeholder="Staying near? (hotel, neighborhood)">`;
h+=`<div class="fr">`;[{id:'all',l:'All'},{id:'restaurant',l:'Eat'},{id:'bar',l:'Drink'},{id:'wine',l:'Wine'}].forEach(v=>{h+=`<button class="fb${S.vibe===v.id?' on':''}" onclick="S.vibe='${v.id}';render()">${v.l}</button>`});
h+=`</div><button class="go" onclick="go()" ${S.loading?'disabled':''}>${S.loading?'¬∑¬∑¬∑':'Discover'}</button>`;
if((lc>0||rc>0)&&!S.loading){h+=`<div class="tbar"><div class="tbar-s">`;if(lc>0)h+=`<span class="lv">‚ô• ${lc}</span>`;if(lc>0&&rc>0)h+=' ¬∑ ';if(rc>0)h+=`<span class="rj">‚úï ${rc}</span>`;h+=`<span style="color:var(--text-l);margin-left:6px">shaping taste</span></div><button class="tbar-r" onclick="clr()">Reset</button></div>`}
if(S.loading){h+=`<div class="ld"><div class="ld-t">${S.phase}</div>`;if(S.loc)h+=`<div class="ld-s">Near ${S.loc}</div>`;h+=`</div>`}
if(S.error)h+=`<div class="err">${S.error}</div>`;
if(S.results){h+=`<div class="cv"><p>${S.results.city_vibe}</p></div>`;S.results.restaurants.forEach((r,i)=>{const isL=S.loved[r.name],isR=S.rejected[r.name],en=esc(r.name);h+=`<div class="rc${isL?' lc':''}${isR?' xc':''}" style="animation:fadeUp .35s ease-out ${i*.04}s both"><div class="rc-top"><div class="rc-i"><div class="rc-nr"><a href="${maps(r)}" target="_blank" class="rc-nm">${r.name}</a><span class="rc-cu">${r.cuisine}</span>`;if(r.price)h+=`<span class="rc-pr">${r.price}</span>`;h+=`</div><div class="rc-loc">${r.neighborhood}${r.walk?`<span style="color:var(--text-d);margin-left:5px">¬∑ ${r.walk}</span>`:''}</div></div><div class="rc-act"><button class="ab${isR?' xo':''}" onclick="tRej('${en}')">‚úï</button><div class="rc-sc"><div class="sn ${sc(r.score)}">${r.score}</div></div><button class="ab${isL?' lo':''}" onclick="tLove('${en}')">‚ô•</button></div></div><p class="rc-sp">${r.spirit}</p><a href="${maps(r)}" target="_blank" class="rc-mp">‚Üí Maps</a></div>`});h+=`<div class="rf">Web-verified ¬∑ Pattern-matched ¬∑ ‚ô• ‚úï train your taste</div>`}
if(!S.loading&&!S.results&&!S.error){h+=`<div class="es"><p>Not where you've been.<br>Where you should go.</p><div class="cp">`;['Tokyo','Lisbon','Buenos Aires','Copenhagen','El Retiro','Barcelona','CDMX','Berlin'].forEach(c=>{h+=`<button class="cpl" onclick="S.city='${c}';render();document.getElementById('ci').value='${c}'">${c}</button>`});h+=`</div></div>`}
h+=`</div>`}

if(S.tab==='scan'){h+=`<div class="scan"><h2>Scan</h2><p class="sh-p">AI-powered menu intelligence</p><button class="scan-cta"><div class="si">üì∑</div><h3>Scan Menu</h3><p>Get picks matched to this palate</p></button><div class="scan-alt"><div class="sa-i">üçæ</div><div><h3>Add a Bottle</h3><p>Photograph to save &amp; rate</p></div></div></div>`}

if(S.tab==='cellar'){h+=`<div class="cel"><h2>Cellar</h2><p class="ch-p">231 wines ¬∑ 12 countries</p><div class="cel-f">`;['All','Regions','Grapes','Insights'].forEach((f,i)=>{h+=`<button class="cft${i===0?' on':''}">${f}</button>`});h+=`</div>`;[{n:'Alonso del Yerro Mar√≠a Ribera del Duero',m:'Ribera del Duero, Spain ¬∑ Tempranillo',s:'5.0',t:1},{n:'Bodegas Alvia Ribeira Sacra Mencia',m:'Ribeira Sacra, Spain ¬∑ Mencia',s:'5.0',t:1},{n:'Bodegas Frontaura Crianza',m:'Toro, Spain ¬∑ Tempranillo',s:'5.0',t:1},{n:'Caymus Cabernet Sauvignon',m:'Napa Valley, USA ¬∑ Cabernet Sauvignon',s:'5.0',t:1},{n:'Domaine Tempier Bandol Ros√©',m:'Bandol, France ¬∑ Mourv√®dre',s:'4.5'}].forEach((w,i)=>{h+=`<div class="wr" style="animation-delay:${i*.05}s"><div class="wr-i"><div class="wr-n">${w.n}</div><div class="wr-m">${w.m}</div></div><div style="text-align:right"><div class="ws ${w.t?'w5':'w4'}">${w.s}</div>${w.t?'<div class="wt">‚òÖ TOP</div>':''}</div></div>`});h+=`</div>`}

document.getElementById('app').innerHTML=h;
const ci=document.getElementById('ci'),li=document.getElementById('li');
if(ci){ci.addEventListener('input',e=>{S.city=e.target.value});ci.addEventListener('keydown',e=>{if(e.key==='Enter')go()})}
if(li)li.addEventListener('input',e=>{S.loc=e.target.value});
}
render();
</script>
</body>
</html>
